<!DOCTYPE html>
<html>
    <head>
        <title>Farmer Login</title>

        <!--link rel=stylesheet href="style.css" type="text/css"--> 
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
		<script>
            window.onload = function(){
               var button = $("#submit_login"); 
               button.on('click', logIn);
               var reg = $("#submit_register")
               reg.on('click', register);
               var ap = $("#addprice");
               ap.on('click', addprice);

               if(hasSessionCookie()){
                    document.getElementById('loginpage').style.display = 'none';
               }else{
                    document.getElementById('addproductpage').style.display = 'none';
               }
                
                
            }
            var register = function(){
                var username = $("#username_register").val();
                var password = $("#password_register").val();
                var check = $("#password_check").val();
                if(check != password){
                    $("#nomatch").html("your passwords did not match!").css("color", "red");
                    return;
                }
                $.ajax({
                    url: "/registerFarm",
                    type: "POST",
                    data: {username: username, password: password, type : "farmer"},
                    success: successRegister,
                    error: errorRegister
                });
            }
            var logIn = function(){
                var username = $("#username").val();
                var password = $("#password").val();
                $.ajax({
                    url: "/loginFarm",
                    type: "POST",
                    data: {username: username, password:password, type:"farmer"},
                    success: successLogIn,
                    error: errorLogIn
                });
                
            }
            function successRegister(){
                document.write("registered");
            }
            function errorRegister(err){
                document.write("err: " + err);
            }
            function successLogIn(){
                document.getElementById('addproductpage').style.display = 'block';
                document.getElementById('loginpage').style.display = 'none';
            }

            function errorLogIn(){
                $("#incorrect").html("incorrect login!").css("color", "red");
            }

            function hasSessionCookie(){
                console.log("checking session cookie\n");
                var cookieArray = document.cookie.split(';');
                var cookies = {};
                for (var i = 0; i < cookieArray.length; i++){
                    var parts = cookieArray[i].split('=');
                    var key = parts[0].trim();
                    var value = parts[1];
                    cookies[key] = value;
                }
                //user will be an id if they're logged in
                return cookies['user'] !== 'none';
            }

            function addprice(){
                var num = $("#pricesdiv div").length;
                var lastDiv = $("#d"+num);
                var lastPrice = Number(lastDiv.children("#p1").val());
                if(isNaN(lastPrice)){
                    $("#v"+num).html("enter a valid price!").css("color", "red");
                    return;
                }
                else{
                   $("#v"+num).html(); 
                }
                
            
            }
        </script>
    </head>

    <body>
        <div id="loginpage">
            <h1>Enter Login Information:</h1>
            <form>
                <label for="username">Email:   </label><input type="text" name="username" id="username"><br>
                <label for="password">Password:   </label><input type="password" name="password" id="password"><br>
            </form>
            <div id="incorrect"></div>
            <button id="submit_login">login</button>
            <h1>Or Register:</h1>
            <form>
                <label for="username_register">Email:   </label>
                <input type="text" name="username_register" id="username_register"><br>
                <label for="password_register">Password:   </label>
                <input type="password" name="password_register" id="password_register"><br>
                <label for="password_check">Re-enter Password:   </label><input type="password" name="password_check" id="password_check"><br>
                <div id="nomatch"></div>
            </form>
            <button id="submit_register">register</button>
        </div> 
        <div id="addproductpage">
            <h1>Add Product:</h1>
            <form>
                <label for="name">name:  </label><input type="text" name="name" id="name"><br>
                <label for="category">category:  </label><input type="text" name="category" id="category"/><br/>
                <label for="description">description:  </label><input type="textarea" name="description" id="description" /><br/>
                <div id="pricesdiv">
                    <div id="d1">
                        <label for="p1">Price:  </label><input type="text" name="p1" id="p1">
                        <label for="u1">Unit:  </label><input type="text" name="u1" id="u1"/>
                        <div id="v1"></div>
                    </div>
                </div>
                
                <button id="addprice">Add Price</button>
                
            </form>
            
        </div>
    </body>
</html>



